<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>1 - Points</title>

    <link rel="stylesheet" href="styles.css"/>
</head>
<body>

<h1>Demo # 1 - Point</h1>

<div class="canvasWrap">
    <img class="loadImg" src="load.gif">
<canvas id="viewport" width="480" height="480"></canvas>
</div>
<!--<canvas id="viewport" width="100" height="200"></canvas>-->

<input id="loadImgBtn" type="file" accept="image/png,image/jpeg"/>

<div id="lips-controller">
    <h3>Lips color</h3>
    <div class="palette">
        <div style="background: #ff5860;"></div>
        <div style="background: #ff4014;"></div>
        <div style="background: #ff0b0c;"></div>
        <br/>
        <div style="background: #ff2275;"></div>
        <div style="background: #ff34ef;"></div>
        <div style="background: #e081ff;"></div>
    </div>
</div>

<script src="app.js"></script>
<script>
    let viewport = document.getElementById("viewport"),
    loadPreview = document.querySelector(".canvasWrap .loadImg");

    const demoData = [{
        "eye_left": [[245, 247], [257, 234], [274, 232], [287, 241], [276, 249], [260, 250]],
        "eyebrow_left": [[233, 218], [253, 210], [273, 208], [293, 210], [312, 216]],
        "face_contour": [[104, 245], [106, 274], [110, 305], [115, 335], [125, 364], [142, 389], [164, 411], [189, 431], [216, 436], [245, 430], [273, 411], [299, 389], [319, 363], [331, 333], [337, 301], [342, 270], [343, 238]],
        "eye_right": [[137, 244], [149, 235], [166, 236], [179, 249], [164, 252], [148, 252]],
        "lips_inner": [
            [172, 355],
            [199, 357], [213, 358], [226, 356],
            [258, 349],
            [227, 364], [213, 366], [200, 365]
        ],
        "lips_outer": [
            [163, 352],
            [183, 352], [199, 350], [212, 352], [226, 348], [245, 348],
            [267, 346],
            [248, 368], [228, 378], [214, 380], [200, 379], [182, 372]
        ],
        "nose_median": [[207, 244], [207, 266], [207, 288], [206, 310]],
        "nose_bottom": [[189, 323], [199, 326], [209, 329], [220, 325], [230, 321]],
        "eyebrow_right": [[116, 222], [129, 212], [146, 210], [165, 211], [183, 219]]
    }];
    // drawPoints(viewport, demoData);

    document.getElementById("loadImgBtn").onchange = function () {
        readURL(this)
            .then(function (resImg) {
                loadPreview.style.visibility = 'visible';
                return loadImage(viewport, resImg);
            })
            .then(function () {
                const base64img = viewport.toDataURL();
                return getPoints(base64img);
            })
            /*.then(function () {
                return new Promise(function (resolve, reject) {
                    resolve(demoData);
                })
            })*/
            .then(function (points) {
                // drawPoints(viewport, points);
                // console.log(points);
                loadPreview.style.visibility = 'hidden';
            })
            .catch(function (err) {
                console.log(err);
                loadPreview.style.visibility = 'hidden';
                // TODO: show popup
            });
    };

    let probes = document.querySelectorAll('#lips-controller .palette > div');
    for (let i = 0; i < probes.length; i++) {
        /**
         *
         * @param {MouseEvent} evt
         */
        let onclick = function (evt) {
            console.log(evt.target.style.backgroundColor);

            let bottomLipPoints = extractBottomLipPoints(demoData[0]);
            fillShape(viewport, bottomLipPoints, evt.target.style.backgroundColor);

            let topLipPoints = extractTopLipPoints(demoData[0]);
            fillShape(viewport, topLipPoints, evt.target.style.backgroundColor);
        };
        probes[i].onclick = onclick
    }
</script>

</body>
</html>